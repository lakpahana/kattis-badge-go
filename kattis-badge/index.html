<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kattis Badge</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
        .input-group {
            margin-top: 30px;
            position: relative;
        }

        .input-group {
            position: relative;
        }

        .input-group-addon {
            border: none;
        }

        .linkname {
            display: none;
        }

        #copyButton {
            cursor: pointer;
            background: #f1bb3a;
        }

        #copyTarget {
            border-left: none;
        }

        .copied {
            opacity: 1;
            position: absolute;
            left: 55px;
        }

        @media (min-width: 768px) {
            .copied {
                left: 135px;
            }

            .linkname {
                display: block;
                background: #3b3e45;
                color: #fff;
            }
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <h2>Kattis Rank Badge</h2>
        <p>üë©‚Äçüíªüë®‚Äçüíªüë©‚Äçüíªüë®‚Äçüíªüë©‚Äçüíªüë®‚Äçüíªüë©‚Äçüíªüë®‚Äçüíª</p>
        <form id="kattisForm">
            <div class="form-group">
                <input type="text" class="form-control" id="usernameInput" placeholder="Enter Kattis username">
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
        <div id="badgeContainer" class="mt-3"></div>

        <div class="input-group">
            <span class="input-group-addon hidden-xs linkname">
                <div id="badgeMarkdown" class="mt-3"></div>
            </span>
            <span id="copyButton" class="input-group-addon btn" title="Click to copy">
                <i class="fa fa-clipboard" aria-hidden="true"></i>
            </span>
            <input type="text" id="copyTarget" class="form-control" value="">
            <span class="copied" style="display: none;">Copied !</span>
        </div>

        <hr>
        <h2>Kattis Users</h2>
        <hr>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Username</th>
                    <th>University</th>
                    <th>Country</th>
                    <th>Rank</th>
                </tr>
            </thead>
            <tbody id="userData"></tbody>
        </table>
    </div>

    <script>
        fetch('https://corsproxy.io/?https%3A%2F%2Fkattis-badge-go-empty-brook-9555.fly.dev%2FallUsers')
            .then(response => response.json())
            .then(data => {
                const uniqueUsernames = new Set();
                const filteredData = data.message.filter(user => {
                    const lowercaseUsername = user.Username.trim().toLowerCase();
                    if (!uniqueUsernames.has(lowercaseUsername)) {
                        uniqueUsernames.add(lowercaseUsername);
                        return true;
                    }
                    return false;
                });
                // Sort filtered data by Country_rank
                filteredData.sort((a, b) => a.Country_rank - b.Country_rank);

                const userData = document.getElementById('userData');

                // const userData = document.getElementById('userData');
                // Clear existing table rows
                userData.innerHTML = '';

                filteredData.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
        <td>${user.Name}</td>
        <td>${user.Username}</td>
        <td>${user.University}</td>
        <td>${user.Country}</td>
        <td>${user.Country_rank}</td>
      `;
                    userData.appendChild(row);
                });
            })
            .catch(error => console.error('Error fetching data:', error));

        (function () {
            "use strict";

            function copyToClipboard(elem) {
                var target = elem;

                // select the content
                var currentFocus = document.activeElement;

                target.focus();
                target.setSelectionRange(0, target.value.length);

                // copy the selection
                var succeed;

                try {
                    succeed = document.execCommand("copy");
                } catch (e) {
                    console.warn(e);
                    succeed = false;
                }

                // Restore original focus
                if (currentFocus && typeof currentFocus.focus === "function") {
                    currentFocus.focus();
                }

                if (succeed) {
                    var copiedElem = document.querySelector(".copied");
                    copiedElem.style.display = "block";
                    copiedElem.style.transition = "top 0.7s, opacity 0.7s";
                    copiedElem.style.top = "-25px";
                    copiedElem.style.opacity = "0";
                    setTimeout(function () {
                        copiedElem.style.top = "0";
                        copiedElem.style.opacity = "1";
                    }, 700);
                    setTimeout(function () {

                        copiedElem.style.display = "none";
                    }, 1000)

                }

                return succeed;
            }

            document.getElementById("copyButton").addEventListener("click", function () {
                copyToClipboard(document.getElementById("copyTarget"));
            });

            document.getElementById("copyTarget").addEventListener("click", function () {
                copyToClipboard(this);
            });
        })();

        document.getElementById('kattisForm').addEventListener('submit', function (event) {
            event.preventDefault();
            const username = document.getElementById('usernameInput').value;
            const badgeUrl = `https://img.shields.io/badge/dynamic/json?url=https%3A%2F%2Fkattis-badge-go-empty-brook-9555.fly.dev%2Frank%2F${username}&query=message&prefix=%23&style=social&logo=data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAAB4AAAAUCAYAAACaq43EAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw%2FeHBhY2tldCBiZWdpbj0i77u%2FIiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8%2BIDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGNUU3QzUwOTE3ODcxMUUyQTcxNDlDNEFCRkNENzc2NiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGNUU3QzUwQTE3ODcxMUUyQTcxNDlDNEFCRkNENzc2NiI%2BIDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkY1RTdDNTA3MTc4NzExRTJBNzE0OUM0QUJGQ0Q3NzY2IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkY1RTdDNTA4MTc4NzExRTJBNzE0OUM0QUJGQ0Q3NzY2Ii8%2BIDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY%2BIDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8%2BynHuxQAABGdJREFUeNqklttvVFUUxn%2F7XOYO03Zm2g6XDhbE1ghEMURRY2IUwpuX8OSbiW8%2B%2BKwvmhhN%2FA%2BM0USJygOJMSYEH1CUBGICUgpUCW3ppNDaMlPauZ3OmXNxndML470tO1mz55yz91r7W%2Btba23lX%2BQmm%2BjGwMXnn4cmYovURbaIGCL%2Ftva%2FRqBnEZ0pZpV7mfrPU4lEsWFi6p7oU8TwOKxqmCvKXZGkyFa4caoXa84kXWjguWpNB1BqaS7fTJHbVaHv2bmG0YxjvXc%2Bnzg51gEpgeUbxFWLKTVCh%2B%2FJLtlRFRmE%2BXic4lAnrbrByQ%2F2EDUdlLYGy37gMIP9r0xQvR0j81TdMnR5GYk7YlQk6YaLUspBU8vuXJlj4DU10n0WDzxdYuJsNkSiGR5aoES12ZFH31Ph%2B2CNXdfJdNd4%2FLUi107k8Wwlx1hRrvwlkReaalOkWP2%2FKb%2FI8FfbufRpgXiXjWPp6KaEx1ehcutuBDPhrlp3bJ1krokZd8M1nx09yJY98zyRHQ9psvYhng8U12ejaEKAAG2mv8b4uRzJTptHXy0yO7KZTdss%2Bp%2B7w9T5TkZ%2F6EaLeHIwA6eiY2puiGRdhv1lopgJJ3yIJCUkgvjhw1PsPjRDZneNymQ8nH872Ut%2B34Kscbn67RY04UK4Ty2FwmCDwxP0yYyN72jEuiwyO2vMDKWpzMQY%2FzGLbypGTnXSf6BEz2CF6eGOv2XWukfIN08T9EKegFi%2Bxi1hezLbpFaKcv74TloNnR0HS3QN1IkKcZ2W%2BpOODSH2Q%2B755PcssFgxufRlHy%2B8ew2z02Hg0DRPvjGGmZNYZmVtE26ezoiL2ljKfbjatTVSwvJI2uGhI9MMvj6NKvn3%2FBjk%2FoKY6obOvkaYXu0ptzFXiwK3qVO%2BkWLb3rs8%2F%2F4IqipG55eYT0oq47RkagKalsnomZ6QhO3FRtsoYmUEiqAlB2jNGDTGIpLoYqhscP2LXqG%2BYlJcXLkSoy75HeT7fZMr3Cik8gXB5KUuPnnpGc59tIvaTJSv33yM428doFqNM%2FTNdhYnTAoHyzhywPa6bqyXzcFPEN9ousXETznshrS1hkbhSImqFP6JoSyFQhnDcNj38iTd%2BytcOLEDT9LOXWa2WrdhQRgYciSVUlEvZHTLMshJni78muC61OFE0iYtlWvo8wKxtE3xYpbyWIp03mKhFMf29DANjdUm0CZ%2Be6lqm635CL2DC%2Bx9e5Lv3nkkRBHvsMXFMc58OIAhzaajx%2BL3q2nGz%2BZW3RRNtsg%2BWOXFj3%2FhyrGt1OaiGI58aAoKKpElRkpbrAptvfbuFKRGAykCGobU6prU6lIphW556PPmUsyFbJ58n7uVXPXOyrBrBsUrOS4f245Tl8JjSOFxh6l%2FX0wlRmuR1YtAQnkcpYK5AlVKLJvlHFsVo6e7aZQjgrR1r2X%2Bb4z8sOjMyUWgZ6BC%2F%2BE7DeVfkKvPZrn6ROSe4f21I7Rxv7l89clvhB3LewI9llx9bjP7hwADADpQzQBjYpxJAAAAAElFTkSuQmCC&label=KATTIS`;
            const badgeMarkdown = `![Dynamic JSON Badge](${badgeUrl})`;
            document.getElementById('badgeContainer').innerHTML = `<img src="${badgeUrl}" alt="Kattis rank badge for ${username}" class="img-fluid">`;
            document.getElementById('copyTarget').value = badgeMarkdown;
        });

    </script>
</body>

</html>